<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Siswa</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f2f4f8;
}

.header{
    background:linear-gradient(135deg,#1e90ff,#6a5acd);
    padding:25px;
    color:white;
    border-bottom-left-radius:30px;
    border-bottom-right-radius:30px;
}

.container{
    padding:20px;
}

.card{
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
    margin-bottom:20px;
}

.nama{ font-size:18px; font-weight:bold; }
.kelas{ color:gray; }

.jam{
    font-size:28px;
    font-weight:bold;
    margin-top:10px;
}

.status{
    font-size:18px;
    font-weight:bold;
    margin-top:10px;
}

.calendar{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:5px;
    margin-top:15px;
}

.day{
    padding:10px;
    border-radius:10px;
    text-align:center;
    color:white;
    font-size:14px;
}

.hadir{ background:#28a745; }
.terlambat{ background:#ffc107; color:black; }
.bolos{ background:#dc3545; }
.sakit{ background:#fd7e14; }
.default{ background:#cfd8dc; color:black; }

.btn{
    padding:10px;
    margin:5px;
    border:none;
    border-radius:20px;
    width:140px;
    color:white;
    cursor:pointer;
}

.btn-hadir{ background:#007bff; }
.btn-sakit{ background:#ff8800; }

.bottom{
    position:fixed;
    bottom:0;
    width:100%;
    background:white;
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    box-shadow:0 -2px 10px rgba(0,0,0,0.1);
}
.bottom div{
    text-align:center;
    font-size:14px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
    <h2>Dashboard Siswa</h2>
</div>

<div class="container">

<div class="card">
    <div class="nama" id="namaSiswa"></div>
    <div class="kelas" id="kelasSiswa"></div>
    <div class="jam" id="jamSekarang"></div>
    <div id="tanggalSekarang"></div>
</div>

<div class="card">
    <div>Status Kehadiran</div>
    <div class="status" id="statusHari"></div>
    <button class="btn btn-hadir" onclick="absen('hadir')">HADIR</button>
    <button class="btn btn-sakit" onclick="absen('sakit')">SAKIT</button>

    <div class="calendar" id="calendar"></div>
</div>

</div>

<div class="bottom">
    <div onclick="tampilBeranda()">Beranda</div>
    <div onclick="tampilProfil()">Profil</div>
    <div onclick="tampilSetting()">Setting</div>
</div>

<script>

// CEK ROLE
if(localStorage.getItem("role") !== "siswa"){
    window.location.href="index.html";
}

// AMBIL DATA KARTU
document.getElementById("namaSiswa").innerText = localStorage.getItem("nama");
document.getElementById("kelasSiswa").innerText = localStorage.getItem("kelas");

// JAM REALTIME
function updateJam(){
    const now = new Date();
    document.getElementById("jamSekarang").innerText =
        now.toLocaleTimeString("id-ID");
    document.getElementById("tanggalSekarang").innerText =
        now.toLocaleDateString("id-ID",{
            weekday:'long',
            day:'numeric',
            month:'long',
            year:'numeric'
        });
}
setInterval(updateJam,1000);
updateJam();

// ABSENSI SYSTEM
const now = new Date();
const today = now.getDate();
const bulan = now.getMonth();
const tahun = now.getFullYear();

function absen(jenis){

    let statusFinal = jenis;

    if(jenis==="hadir"){
        const menitSekarang = now.getHours()*60 + now.getMinutes();
        const batas = 7*60 + 15;
        if(menitSekarang > batas){
            statusFinal = "terlambat";
        } else {
            statusFinal = "hadir";
        }
    }

    localStorage.setItem(
        "absen_"+today+"_"+bulan+"_"+tahun,
        JSON.stringify({status:statusFinal})
    );

    cekStatus();
    loadCalendar();
}

function cekStatus(){
    const data = JSON.parse(localStorage.getItem(
        "absen_"+today+"_"+bulan+"_"+tahun
    ));

    const status = document.getElementById("statusHari");

    if(!data){
        status.innerText="Belum Absen";
        status.style.color="black";
        return;
    }

    if(data.status==="hadir"){
        status.innerText="HADIR";
        status.style.color="green";
    }

    if(data.status==="terlambat"){
        status.innerText="TERLAMBAT";
        status.style.color="orange";
    }

    if(data.status==="bolos"){
        status.innerText="BOLOS";
        status.style.color="red";
    }

    if(data.status==="sakit"){
        status.innerText="SAKIT";
        status.style.color="#ff8800";
    }
}

function loadCalendar(){
    const cal = document.getElementById("calendar");
    cal.innerHTML="";
    const total = new Date(tahun,bulan+1,0).getDate();

    for(let i=1;i<=total;i++){
        const div=document.createElement("div");
        div.classList.add("day");

        const data=JSON.parse(localStorage.getItem(
            "absen_"+i+"_"+bulan+"_"+tahun
        ));

        if(data){
            div.classList.add(data.status);
        }else if(i<today){
            div.classList.add("bolos");
            localStorage.setItem(
                "absen_"+i+"_"+bulan+"_"+tahun,
                JSON.stringify({status:"bolos"})
            );
        }else{
            div.classList.add("default");
        }

        div.innerText=i;
        cal.appendChild(div);
    }
}

cekStatus();
loadCalendar();

// MENU BAWAH
function tampilBeranda(){
    alert("Beranda Aktif");
}

function tampilProfil(){
    alert("Nama: "+localStorage.getItem("nama")+
    "\nKelas: "+localStorage.getItem("kelas"));
}

function tampilSetting(){
    alert("Pengaturan UI, Bahasa, Suara");
}

</script>

</body>
</html>
