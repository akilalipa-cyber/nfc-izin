<script>
let nama = "";
let kelas = "";

document.getElementById("scan").onclick = async () => {
  try {
    const ndef = new NDEFReader();
    await ndef.scan();
    document.getElementById("data").textContent = "Tempelkan kartu NFC...";

    ndef.onreading = event => {
      const decoder = new TextDecoder();
      let text = "";

      for (const record of event.message.records) {
        text += decoder.decode(record.data);
      }

      document.getElementById("data").textContent = text;

      text.split("\n").forEach(line => {
        if (line.startsWith("NAMA=")) nama = line.replace("NAMA=", "");
        if (line.startsWith("KELAS=")) kelas = line.replace("KELAS=", "");
      });

      mulaiCountdownDetik(3);
    };
  } catch (e) {
    document.getElementById("data").textContent = "NFC gagal dibaca";
  }
};

function mulaiCountdownDetik(detik) {
  let waktu = detik;
  const timer = document.getElementById("timer");

  const interval = setInterval(() => {
    timer.textContent = `Sisa waktu: ${waktu} detik`;
    waktu--;

    if (waktu < 0) {
      clearInterval(interval);
      timer.textContent = "WAKTU HABIS";
      sebutkanNama();
    }
  }, 1000);
}

function sebutkanNama() {
  const suara = new SpeechSynthesisUtterance(
    `Waktu habis. ${nama}. Kelas ${kelas}`
  );
  suara.lang = "id-ID";
  speechSynthesis.speak(suara);
}
</script>
