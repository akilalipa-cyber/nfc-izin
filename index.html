<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Absensi NFC</title>

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(180deg,#4ea8de 0%,#f5f5f5 40%);
  text-align:center;
}

/* HEADER */
.header{
  padding:60px 20px 80px;
  color:white;
}

.header h1{
  font-size:36px;
  margin:0;
}

.header span{
  font-size:14px;
}

/* CONTENT */
.content{
  margin-top:60px;
}

.content h2{
  font-size:28px;
  margin-bottom:25px;
}

button{
  background:linear-gradient(135deg,#4ea8de,#3a86ff);
  border:none;
  padding:15px 50px;
  border-radius:40px;
  font-size:20px;
  color:white;
  cursor:pointer;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}

button:hover{
  transform:scale(1.05);
}

#info{
  margin-top:20px;
  font-size:14px;
  color:#3a86ff;
}
</style>
</head>

<body>

<div class="header">
  <h1>SMA-TAS</h1>
  <span>SMAN 1 BIAU BERINTEGRITAS</span>
</div>

<div class="content">
  <h2>SELAMAT DATANG</h2>
  <button id="scanBtn">SCAN KARTU NFC</button>
  <div id="info">Tempelkan kartu NFC</div>
</div>

<script>
const info = document.getElementById("info");
const btn = document.getElementById("scanBtn");

btn.onclick = async ()=>{
  if(!("NDEFReader" in window)){
    info.textContent="Gunakan Chrome Android";
    return;
  }

  try{
    const ndef = new NDEFReader();
    await ndef.scan();
    info.textContent="Membaca kartu...";

    ndef.onreading = e=>{
      let data={};
      for(const r of e.message.records){
        if(r.recordType==="text"){
          const text = new TextDecoder(r.encoding).decode(r.data);
          text.split("\n").forEach(l=>{
            const [k,v]=l.split("=");
            if(k && v) data[k.trim()]=v.trim();
          });
        }
      }

      if(!data.ROLE){
        info.textContent="Role tidak ditemukan";
        return;
      }

      localStorage.setItem("user",JSON.stringify(data));

      if(data.ROLE==="gerbang") location.href="gerbang.html";
      else if(data.ROLE==="operator") location.href="operator.html";
      else if(data.ROLE==="wali") location.href="wali.html";
      else if(data.ROLE==="guru") location.href="guru.html";
      else if(data.ROLE==="siswa") location.href="siswa.html";
    };

  }catch{
    info.textContent="Gagal membaca NFC";
  }
}
</script>

</body>
</html>
